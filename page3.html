<!DOCTYPE html>
<html>
<head>
<style>
	html, body
	{
		width: 100%;
		height: 100%;
		margin: 0;
	}
	#map
	{
		margin:10px;
	}
</style>
<script>
	require([
	"esri/map",
	"esri/layers/FeatureLayer",
	"esri/symbols/SimpleFillSymbol",
	"esri/Color",
	"esri/symbols/SimpleLineSymbol",
	"esri/graphic",
	"dojo/domReady!"],
	function(
		Map,
		FeatureLayer,
		SimpleFillSymbol,
		Color,
		SimpleLineSymbol,
		Graphic)
	{
			$("document").ready(function()
			{
			var page3Map = new Map("map",
			{
				basemap: "topo",
				extent: window.copyExtent
			});
			
			page3LayerURL = window.url + "/" + window.visibleLayer;
			var page3Layer = new FeatureLayer(page3LayerURL);
			
			page3Map.on("load",function()
			{
				page3Map.addLayers([page3Layer]);
				page3Map.on("click",citySDKQuery);
			});
			
			function citySDKQuery(evt)
			{
				var sdk = new CitySDK();
				var censusModule = sdk.modules.census;
				censusModule.enable("315210ddaf6505f170cb116e16d5a1ec69ffe699");
				var tempVars = $(":checked");
				var censusVars = [];
				
				for (i=0; i<tempVars.length; i++)
				{
					censusVars.push(tempVars[i].value)
				}

				if (typeof polyGraphic != 'undefined')
				{
					page3Map.graphics.remove(polyGraphic);
				}
				
				var lat = evt.mapPoint.getLatitude();
				var lng = evt.mapPoint.getLongitude();
				
				var sfs = new SimpleFillSymbol(SimpleFillSymbol.STYLE_DIAGONAL_CROSS,
				new SimpleLineSymbol(SimpleLineSymbol.STYLE_DASHDOT,
				new Color([255,0,0]), 2),new Color([255,255,0,0.25]));
				polyGraphic = new Graphic(evt.graphic.geometry, sfs);
				
				page3Map.graphics.add(polyGraphic);
				
				var request = 
				{
					"lat":lat,
					"lng":lng,
					"level":"tract",
					"container":"state",
					"variables":censusVars
				}
				
				censusModule.APIRequest(request,function(response)
				{
					console.log("response");
					console.log(response);
				});
			}
		});
	});
	
</script>


</head>

	<body class="claro">
		<div id="censusVariables">
			<p>Now that we have the web service on the map, we need to specify the variables to enrich the polygon with from the Census data.  Select a few checkboxes below and then select a single polygon on the map.  This will send a request via the CitySDK.  
			</p>
			<br>
			<table>
				<tr>
					<td><input type="checkbox" name="variable" value="population">Total Population</td>
					<td><input type="checkbox" name="variable" value="income">Median Household Income</td>
					<td><input type="checkbox" name="variable" value="employment_unemployed">Unemployed (16&Older)</td>
					<td><input type="checkbox" name="variable" value="poverty_family">Poverty (Families)</td>
				</tr>
			</table>
			<br>
			<button id="next1">Next</button>
		</div>
		<div id="map"></map>
	</body>
</html>